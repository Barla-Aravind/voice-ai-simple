<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice AI - Streaming Analytics</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .main-section { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); margin-bottom: 20px; }
        h1 { color: #333; margin-bottom: 10px; text-align: center; font-size: 28px; }
        .badge { text-align: center; color: #27ae60; margin-bottom: 30px; font-size: 14px; font-weight: bold; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #333; font-weight: 500; font-size: 14px; }
        textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; font-family: inherit; resize: vertical; min-height: 100px; }
        textarea:focus { outline: none; border-color: #667eea; box-shadow: 0 0 5px rgba(102, 126, 234, 0.3); }
        button { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4); }
        #status { margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 8px; color: #333; min-height: 20px; border-left: 4px solid #667eea; }
        #player { width: 100%; margin-top: 20px; }
        .success { color: #27ae60; background: #d5f4e6 !important; border-left-color: #27ae60 !important; }
        .error { color: #e74c3c; background: #fadbd8 !important; border-left-color: #e74c3c !important; }
        .loading { color: #667eea; font-weight: bold; }
        #analytics-dashboard { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); }
        .analytics-header { color: #333; margin-bottom: 25px; font-size: 24px; font-weight: bold; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; color: white; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2); }
        .metric-label { font-size: 13px; opacity: 0.9; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .metric-value { font-size: 32px; font-weight: bold; }
        .events-section { background: #f9f9f9; padding: 20px; border-radius: 10px; border-left: 4px solid #667eea; }
        .events-title { color: #333; margin-bottom: 15px; font-size: 18px; font-weight: bold; }
        .events-list { max-height: 300px; overflow-y: auto; }
        .event-item { background: white; padding: 12px; margin-bottom: 10px; border-radius: 8px; border-left: 3px solid #667eea; font-size: 13px; }
        .event-text { color: #333; font-weight: bold; margin-bottom: 5px; }
        .event-meta { color: #999; font-size: 12px; }
        .no-events { color: #999; text-align: center; padding: 30px; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-section">
            <h1>üé§ Voice AI System</h1>
            <div class="badge">‚úÖ Text-to-Speech | üí∞ Cost: $0.00 | üîë Free & Open</div>
            
            <div class="form-group">
                <label for="text">üìù Enter Your Text:</label>
                <textarea id="text" placeholder="Type your text here...">Hello! This is a voice synthesis test.</textarea>
            </div>
            
            <button onclick="generateSpeech()">üéµ Generate Speech</button>
            <div id="status"></div>
            <audio id="player" controls style="width:100%; margin-top:20px;"></audio>
        </div>
        
        <div id="analytics-dashboard">
            <div class="analytics-header">üìä Live Analytics Dashboard</div>
            
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-label">Total Requests</div>
                    <div class="metric-value" id="total-requests">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Average Text Length</div>
                    <div class="metric-value" id="avg-text-length">0</div>
                </div>
                <div class="metric-card">
                    <div class="metric-label">Last Request</div>
                    <div class="metric-value" id="last-request-time" style="font-size: 16px;">--</div>
                </div>
            </div>
            
            <div class="events-section">
                <div class="events-title">üìà Recent Requests</div>
                <div class="events-list" id="events-list">
                    <div class="no-events">No requests yet. Generate some speech!</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let apiBase = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') 
            ? 'http://localhost:5000' 
            : window.location.origin;
        
        console.log('‚úÖ API:', apiBase);
        
        async function generateSpeech() {
            const text = document.getElementById('text').value.trim();
            const status = document.getElementById('status');
            const player = document.getElementById('player');
            
            if (!text) {
                status.className = 'error';
                status.textContent = '‚ùå Please enter text!';
                return;
            }
            
            status.className = 'loading';
            status.textContent = '‚è≥ Generating...';
            
            try {
                const response = await fetch(apiBase + '/api/v1/synthesize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    player.src = apiBase + data.audio_url;
                    status.className = 'success';
                    status.textContent = `‚úÖ Success! ${data.provider}`;
                    setTimeout(updateAnalytics, 500);
                } else {
                    status.className = 'error';
                    status.textContent = `‚ùå ${data.error}`;
                }
            } catch (error) {
                status.className = 'error';
                status.textContent = `‚ùå Error: ${error.message}`;
                console.error(error);
            }
        }
        
        function updateAnalytics() {
            fetch(apiBase + '/api/v1/analytics')
                .then(r => r.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('total-requests').textContent = data.total_requests;
                        document.getElementById('avg-text-length').textContent = data.avg_text_length;
                        
                        if (data.events.length > 0) {
                            const lastEvent = data.events[0];
                            document.getElementById('last-request-time').textContent = 
                                new Date(lastEvent.timestamp * 1000).toLocaleTimeString();
                            
                            document.getElementById('events-list').innerHTML = data.events.map((e, i) => `
                                <div class="event-item">
                                    <div class="event-text">#${data.total_requests - i}: ${e.text.substring(0, 40)}${e.text.length > 40 ? '...' : ''}</div>
                                    <div class="event-meta">Length: ${e.length} | Time: ${new Date(e.timestamp * 1000).toLocaleTimeString()} | Size: ${e.file_size}</div>
                                </div>
                            `).join('');
                        }
                    }
                }).catch(e => console.log('Analytics error:', e));
        }
        
        setInterval(updateAnalytics, 2000);
        updateAnalytics();
    </script>
</body>
</html>